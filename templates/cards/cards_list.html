{% extends 'base.html' %}

{% block content %}
<div class="flex items-center justify-between mb-4">
    <h1 class="text-2xl font-bold text-slate-800">Dashboard de tarjetas</h1>
    <a href="{% url 'card_create' %}"
       class="inline-flex items-center gap-1 text-sm px-3 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-700">
        <span>➕</span>
        <span>Agregar tarjeta</span>
    </a>
</div>

{% if cards %}

    <!-- Resumen principal -->
    <div class="grid gap-4 md:grid-cols-2 mb-6">

        <!-- Próxima tarjeta a pagar -->
        <div class="bg-white rounded-xl shadow-sm p-4 border border-slate-100">
            <h2 class="text-sm font-semibold text-slate-500 uppercase tracking-wide mb-2">
                Próxima tarjeta a pagar
            </h2>
            {% if next_to_pay %}
                <div>
                    <p class="text-lg font-semibold" style="color: {{ next_to_pay.color }}">
                        {{ next_to_pay.banco }} – {{ next_to_pay.nombre }}
                    </p>
                    <p class="text-sm text-slate-600 mt-1">
                        Fecha límite real:
                        <span class="font-semibold">
                            {{ next_to_pay.proxima_fecha_limite_real }}
                        </span>
                    </p>
                    <p class="text-sm text-slate-600">
                        Saldo: <span class="font-semibold">${{ next_to_pay.saldo_actual }}</span>
                    </p>
                </div>
            {% else %}
                <p class="text-sm text-slate-500">No hay tarjetas registradas.</p>
            {% endif %}
        </div>

        <!-- Tarjeta recomendada para usar hoy -->
        <div class="bg-white rounded-xl shadow-sm p-4 border border-slate-100">
            <h2 class="text-sm font-semibold text-slate-500 uppercase tracking-wide mb-2">
                Tarjeta recomendada para usar hoy
            </h2>
            {% if recommended_card %}
                <div>
                    <p class="text-lg font-semibold" style="color: {{ recommended_card.color }}">
                        {{ recommended_card.banco }} – {{ recommended_card.nombre }}
                    </p>
                    <p class="text-sm text-slate-600 mt-1">
                        Próxima fecha de corte:
                        <span class="font-semibold">
                            {{ recommended_card.proxima_fecha_corte_real }}
                        </span>
                    </p>
                    <p class="text-sm text-slate-600">
                        Límite: <span class="font-semibold">${{ recommended_card.limite_credito }}</span>
                    </p>
                </div>
            {% else %}
                <p class="text-sm text-slate-500">Agrega al menos una tarjeta para ver la recomendación.</p>
            {% endif %}
        </div>

    </div>

    <!-- Lista de tarjetas -->
    <section class="mb-6">
        <h2 class="text-lg font-semibold text-slate-800 mb-3">Todas tus tarjetas (ordenadas por urgencia)</h2>

        <div class="space-y-3">
            {% for card in cards %}
                <div class="bg-white rounded-xl border border-slate-100 p-4 flex flex-col gap-2">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="font-semibold text-slate-800" style="color: {{ card.color }}">
                                {{ card.banco }} – {{ card.nombre }}
                            </p>
                            <p class="text-xs text-slate-500">
                                Fecha real límite: {{ card.proxima_fecha_limite_real }}
                            </p>
                        </div>
                        <div class="text-right text-sm text-slate-600">
                            <p>Límite: <span class="font-semibold">${{ card.limite_credito }}</span></p>
                            <p>Saldo: <span class="font-semibold">${{ card.saldo_actual }}</span></p>
                        </div>
                    </div>
                    <div class="flex items-center justify-between text-xs text-slate-500">
                        <p>Corte: día {{ card.fecha_corte }}</p>
                        <p>Pago límite: día {{ card.fecha_limite_pago }}</p>
                    </div>
                    <div class="text-right text-sm">
                        <a href="{% url 'card_update' card.pk %}"
                           class="text-indigo-600 hover:text-indigo-700 mr-2">
                            Editar
                        </a>
                        <a href="{% url 'card_delete' card.pk %}"
                           class="text-red-500 hover:text-red-600">
                            Eliminar
                        </a>
                    </div>
                </div>
            {% endfor %}
        </div>
    </section>

    <!-- Calendario simple -->
    <section>
        <h2 class="text-lg font-semibold text-slate-800 mb-3">Calendario de cortes y pagos</h2>

        {% if eventos %}
            <div class="bg-white rounded-xl border border-slate-100 p-4">
                <ul class="space-y-2 text-sm">
                    {% for e in eventos %}
                        <li class="flex items-center justify-between">
                            <span class="text-slate-600">
                                <span class="font-semibold">{{ e.fecha }}</span> ·
                                {{ e.tipo }} ·
                                {{ e.card.banco }} – {{ e.card.nombre }}
                            </span>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        {% else %}
            <p class="text-sm text-slate-500">
                Aún no hay fechas porque no tienes tarjetas registradas.
            </p>
        {% endif %}
    </section>

{% else %}
    <p class="text-sm text-slate-600 mb-3">
        Aún no tienes tarjetas registradas. Empieza agregando la primera.
    </p>
    <a href="{% url 'card_create' %}"
       class="inline-flex items-center gap-1 text-sm px-3 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-700">
        <span>➕</span>
        <span>Agregar tarjeta</span>
    </a>
{% endif %}

{% endblock %}
