{% extends 'base.html' %}

{% block content %}
<div class="flex items-center justify-between mb-4">
    <h1 class="text-2xl font-bold text-slate-800">Dashboard de tarjetas</h1>
    <a href="{% url 'card_create' %}"
       class="inline-flex items-center gap-1 text-sm px-3 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-700">
        <span>➕</span>
        <span>Agregar tarjeta</span>
    </a>
</div>

{% if cards %}

<!-- Resumen principal -->
<div class="grid gap-4 grid-cols-1 md:grid-cols-2 mb-8">

    <!-- Próxima tarjeta -->
    <div class="bg-white rounded-xl shadow-sm p-5 border border-slate-200">
        <div class="flex items-center gap-3 mb-3">
            <div class="bg-indigo-100 text-indigo-600 p-2 rounded-lg">
                <i data-feather="alert-circle" class="w-5 h-5"></i>
            </div>
            <h2 class="text-sm font-semibold text-slate-600 uppercase tracking-wide">
                Próxima tarjeta a pagar
            </h2>
        </div>

        {% if next_to_pay %}
        <div>
            <p class="text-lg font-semibold" style="color: {{ next_to_pay.color }}">
                {{ next_to_pay.banco }} – {{ next_to_pay.nombre }}
            </p>
            <p class="text-sm text-slate-600 mt-1">
                Fecha límite real:  
                <span class="font-semibold">
                    {{ next_to_pay.proxima_fecha_limite_real|date:"j \\d\\e F \\d\\e Y" }}
                </span>
            </p>
            <p class="text-sm text-slate-600">
                Saldo: <span class="font-semibold">${{ next_to_pay.saldo_actual }}</span>
            </p>
        </div>
        {% else %}
            <p class="text-sm text-slate-500">No hay tarjetas registradas.</p>
        {% endif %}
    </div>

    <!-- Tarjeta recomendada -->
    <div class="bg-white rounded-xl shadow-sm p-5 border border-slate-200">
        <div class="flex items-center gap-3 mb-3">
            <div class="bg-green-100 text-green-600 p-2 rounded-lg">
                <i data-feather="thumbs-up" class="w-5 h-5"></i>
            </div>
            <h2 class="text-sm font-semibold text-slate-600 uppercase tracking-wide">
                Tarjeta recomendada para usar hoy
            </h2>
        </div>

        {% if recommended_card %}
        <div>
            <p class="text-lg font-semibold" style="color: {{ recommended_card.color }}">
                {{ recommended_card.banco }} – {{ recommended_card.nombre }}
            </p>
            <p class="text-sm text-slate-600 mt-1">
                Próxima fecha de corte:  
                <span class="font-semibold">
                    {{ recommended_card.proxima_fecha_corte_real|date:"j \\d\\e F \\d\\e Y" }}
                </span>
            </p>
            <p class="text-sm text-slate-600">
                Límite: <span class="font-semibold">${{ recommended_card.limite_credito }}</span>
            </p>
        </div>
        {% else %}
            <p class="text-sm text-slate-500">Agrega una tarjeta para ver la recomendación.</p>
        {% endif %}
    </div>

</div>

    </div>

    <!-- Lista de tarjetas -->
    <div class="space-y-3">
        {% for card in cards %}
            <div class="bg-white rounded-xl border border-slate-200 p-3 md:p-4 flex flex-col gap-3 shadow-sm">

                <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-3">

                    <!-- Info principal -->
                    <div class="space-y-1">
                        <div class="flex items-center gap-2">
                            <div class="w-2 h-6 rounded-full" style="background-color: {{ card.color }}"></div>
                            <p class="font-semibold text-slate-800">
                                {{ card.banco }} – {{ card.nombre }}
                            </p>
                        </div>

                        <p class="text-xs text-slate-500">
                            Fecha real límite:
                            {{ card.proxima_fecha_limite_real|date:"j \\d\\e F \\d\\e Y" }}
                        </p>

                        <div class="flex flex-wrap gap-x-4 gap-y-1 text-xs text-slate-500">
                            <span>Corte: día {{ card.fecha_corte }}</span>
                            <span>Pago límite: día {{ card.fecha_limite_pago }}</span>
                        </div>
                    </div>

                    <!-- Importes -->
                    <div class="text-sm text-slate-700 md:text-right">
                        <p>
                            Límite:
                            <span class="font-semibold">
                                ${{ card.limite_credito }}
                            </span>
                        </p>
                        <p>
                            Saldo:
                            <span class="font-semibold {% if card.saldo_actual > 0 %}text-red-500{% endif %}">
                                ${{ card.saldo_actual }}
                            </span>
                        </p>
                    </div>
                </div>

                <!-- Acciones -->
                <div class="flex items-center justify-end gap-3 text-sm">
                    <a href="{% url 'card_update' card.pk %}"
                       class="text-indigo-600 hover:text-indigo-700">
                        Editar
                    </a>
                    <a href="{% url 'card_delete' card.pk %}"
                       class="text-red-500 hover:text-red-600">
                        Eliminar
                    </a>
                </div>

            </div>
        {% endfor %}
    </div>


    <!-- Calendario simple -->
    <section>
    <h2 class="text-lg font-semibold text-slate-800 mb-3">Calendario de cortes y pagos</h2>

    {% if eventos %}
        <div class="bg-white rounded-xl border border-slate-200 p-3 md:p-4 shadow-sm">
            <ul class="space-y-1 text-sm md:space-y-2">
                {% for e in eventos %}
                    <li class="flex items-center justify-between">
                        <span class="font-medium text-slate-700">
                            {{ e.fecha|date:"j \\d\\e F \\d\\e Y" }}
                        </span>
                        <span class="text-slate-600">
                            · {{ e.tipo }} – 
                            <span class="font-semibold">{{ e.card.banco }}</span>
                        </span>
                    </li>
                {% endfor %}
            </ul>
        </div>
    {% else %}
        <p class="text-sm text-slate-500">No hay eventos.</p>
    {% endif %}
</section>


{% else %}
    <div class="bg-yellow-50 border border-yellow-200 text-yellow-700 p-4 rounded-lg mb-4">
        <p class="font-medium">Aún no has registrado ninguna tarjeta.</p>
        <p class="text-sm mt-1">Comienza agregando tu primera tarjeta para activar tu dashboard financiero.</p>
    </div>

    <a href="{% url 'card_create' %}"
        class="inline-flex items-center gap-1 text-sm px-3 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-700">
        <span>➕</span>
        <span>Agregar tarjeta</span>
    </a>
{% endif %}


{% endblock %}
